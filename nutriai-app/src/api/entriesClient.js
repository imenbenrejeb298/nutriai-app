import { API_BASE_URL } from \'./config\';\n\n/**\n * API client for daily entries.\n */\n\nfunction getToken() {\n  return localStorage.getItem(\'nutriai.token\');\n}\n\nexport async function saveEntry(entry) {\n  const token = getToken();\n  const headers = { \'Content-Type\': \'application/json\' };\n  if (token) headers[\'Authorization\'] = `Bearer ${token}`;\n\n  const res = await fetch(`${API_BASE_URL}/api/entries\`, {\n    method: \'POST\',\n    headers,\n    body: JSON.stringify(entry),\n  });\n\n  if (!res.ok) {\n    throw new Error(await res.text());\n  }\n\n  const saved = await res.json();\n  const allEntries = await listEntries(); // Refetch all entries\n  return { saved, entries: allEntries };\n}\n\nexport async function listEntries() {\n  const token = getToken();\n  const headers = {};\n  let url = `${API_BASE_URL}/api/entries`;\n\n  if (token) {\n    try {\n      const profileId = JSON.parse(atob(token.split(\'.\')[1])).profile_id;\n      headers[\'Authorization\'] = `Bearer ${token}`;\n      url += `?profile_id=${profileId}`;\n    } catch (e) {\n      console.error(\'Invalid token\', e);\n    }\n  }\n\n  const res = await fetch(url, { headers });\n  if (res.ok) {\n    const serverEntries = await res.json();\n    return serverEntries;\n  }\n  return [];\n}\n